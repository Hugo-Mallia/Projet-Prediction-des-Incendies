<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audit de Prévention des Incendies</title>
    <link rel="stylesheet" href="/static/style.css">
    <style>
        #auditResult {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ccc;
            background-color: #f9f9f9;
        }
    </style>
</head>
<body>
    <h1>Audit de Prévention des Incendies</h1>
    <div style="display: flex; gap: 20px;">
        <!-- Formulaire -->
        <form id="auditForm" style="flex: 1;">
            <h2>Informations générales</h2>
            <label for="buildingName">Nom du bâtiment :</label>
            <input type="text" id="buildingName" name="buildingName" required><br><br>

            <label for="buildingType">Type de bâtiment :</label>
            <select id="buildingType" name="buildingType" required>
                <option value="immeuble">Immeuble</option>
                <option value="maison">Maison</option>
                <option value="entrepot">Entrepôt</option>
                <option value="usine">Usine</option>
                <option value="etablissement_public">Établissement recevant du public</option>
            </select><br><br>

            <label for="buildingUsage">Usage du bâtiment :</label>
            <select id="buildingUsage" name="buildingUsage" required onchange="toggleAuditSections()">
                <option value="professionnel">Entreprise</option>
                <option value="personnel">Habitation</option>
            </select><br><br>

            <label for="buildingSize">Taille du bâtiment (en m²) :</label>
            <input type="number" id="buildingSize" name="buildingSize" min="0" required><br><br>

            <!-- Section Habitation -->
            <div id="habitationSection" style="display:none;">
                <h2>Évaluation des Risques</h2>
                <label>Quels sont les risques d'incendie spécifiques à l'habitation ?</label>
                <textarea name="homeSpecificRisks" rows="2"></textarea><br><br>
                <label>Y a-t-il des sources potentielles d'incendie (cuisine, chauffage, installations électriques) ?</label>
                <textarea name="homeFireSources" rows="2"></textarea><br><br>

                <h2>Conformité et Réglementation</h2>
                <label>L'habitation est-elle conforme aux normes de sécurité incendie en vigueur ?</label>
                <select name="homeCompliance">
                    <option value="oui">Oui</option>
                    <option value="non">Non</option>
                </select><br><br>
                <label>Les extincteurs et autres équipements de sécurité sont-ils présents et en bon état de fonctionnement ?</label>
                <select name="homeEquipmentsOk">
                    <option value="oui">Oui</option>
                    <option value="non">Non</option>
                </select><br><br>

                <h2>Sensibilisation et Formation</h2>
                <label>Les occupants sont-ils informés des procédures à suivre en cas d'incendie ?</label>
                <select name="homeAwareness">
                    <option value="oui">Oui</option>
                    <option value="non">Non</option>
                </select><br><br>
                <label>Des exercices d'évacuation sont-ils régulièrement organisés ?</label>
                <select name="homeDrills">
                    <option value="oui">Oui</option>
                    <option value="non">Non</option>
                </select><br><br>

                <h2>Équipements de Sécurité</h2>
                <label>Les détecteurs de fumée sont-ils installés et fonctionnels ?</label>
                <select name="homeSmokeDetectors">
                    <option value="oui">Oui</option>
                    <option value="non">Non</option>
                </select><br><br>
                <label>Y a-t-il des extincteurs accessibles et en nombre suffisant ?</label>
                <select name="homeExtinguishersEnough">
                    <option value="oui">Oui</option>
                    <option value="non">Non</option>
                </select><br><br>

                <h2>Plans d'Évacuation</h2>
                <label>Existe-t-il un plan d'évacuation clair et affiché ?</label>
                <select name="homeEvacPlan">
                    <option value="oui">Oui</option>
                    <option value="non">Non</option>
                </select><br><br>
                <label>Les issues de secours sont-elles dégagées et facilement accessibles ?</label>
                <select name="homeExitsClear">
                    <option value="oui">Oui</option>
                    <option value="non">Non</option>
                </select><br><br>
            </div>

            <!-- Section Entreprise -->
            <div id="entrepriseSection" style="display:none;">
                <h2>Évaluation des Risques</h2>
                <label>Quels sont les risques d'incendie spécifiques à l'entreprise ?</label>
                <textarea name="companySpecificRisks" rows="2"></textarea><br><br>
                <label>Y a-t-il des zones à haut risque (stockage de produits inflammables, ateliers de production) ?</label>
                <textarea name="companyHighRiskZones" rows="2"></textarea><br><br>

                <h2>Conformité et Réglementation</h2>
                <label>L'entreprise est-elle conforme aux normes de sécurité incendie en vigueur ?</label>
                <select name="companyCompliance">
                    <option value="oui">Oui</option>
                    <option value="non">Non</option>
                </select><br><br>
                <label>Les équipements de sécurité (extincteurs, alarmes, sprinklers) sont-ils conformes et en bon état de fonctionnement ?</label>
                <select name="companyEquipmentsOk">
                    <option value="oui">Oui</option>
                    <option value="non">Non</option>
                </select><br><br>

                <h2>Sensibilisation et Formation</h2>
                <label>Les employés sont-ils formés aux procédures de sécurité incendie ?</label>
                <select name="companyTraining">
                    <option value="oui">Oui</option>
                    <option value="non">Non</option>
                </select><br><br>
                <label>Des exercices d'évacuation sont-ils régulièrement organisés ?</label>
                <select name="companyDrills">
                    <option value="oui">Oui</option>
                    <option value="non">Non</option>
                </select><br><br>

                <h2>Équipements de Sécurité</h2>
                <label>Les détecteurs de fumée et les alarmes incendie sont-ils installés et fonctionnels ?</label>
                <select name="companySmokeDetectors">
                    <option value="oui">Oui</option>
                    <option value="non">Non</option>
                </select><br><br>
                <label>Y a-t-il des extincteurs accessibles et en nombre suffisant ?</label>
                <select name="companyExtinguishersEnough">
                    <option value="oui">Oui</option>
                    <option value="non">Non</option>
                </select><br><br>

                <h2>Gestion des Risques</h2>
                <label>Des audits de sécurité incendie sont-ils réalisés régulièrement ?</label>
                <select name="companyRegularAudits">
                    <option value="oui">Oui</option>
                    <option value="non">Non</option>
                </select><br><br>
                <label>Les recommandations des audits précédents ont-elles été mises en œuvre ?</label>
                <select name="companyAuditRecommendations">
                    <option value="oui">Oui</option>
                    <option value="non">Non</option>
                </select><br><br>

                <h2>Responsabilités et Procédures</h2>
                <label>Qui est responsable de la sécurité incendie dans l'entreprise ?</label>
                <input type="text" name="companyFireSafetyResponsible"><br><br>
                <label>Existe-t-il des procédures claires pour signaler et gérer un incendie ?</label>
                <select name="companyFireProcedures">
                    <option value="oui">Oui</option>
                    <option value="non">Non</option>
                </select><br><br>
            </div>

            <h2>Équipements de sécurité</h2>
            <label for="fireExtinguishers">Nombre d'extincteurs :</label>
            <input type="number" id="fireExtinguishers" name="fireExtinguishers" min="0" required><br><br>

            <label for="emergencyExits">Nombre de sorties de secours :</label>
            <input type="number" id="emergencyExits" name="emergencyExits" min="0" required><br><br>

            <label for="smokeDetectors">Nombre de détecteurs de fumée :</label>
            <input type="number" id="smokeDetectors" name="smokeDetectors" min="0" required><br><br>

            <label for="fireDrills">Dernière date d'exercice d'évacuation :</label>
            <input type="date" id="fireDrills" name="fireDrills" required><br><br>

            <h2>Structure et conformité</h2>
            <label for="roomCount">Nombre de pièces dans le bâtiment :</label>
            <input type="number" id="roomCount" name="roomCount" min="1" required><br><br>

            <label for="roomSizes">Taille de chaque pièce (en m², séparées par des virgules) :</label>
            <input type="text" id="roomSizes" name="roomSizes" placeholder="Exemple : 20, 15, 30" required><br><br>

            <label for="constructionMaterials">Matériaux de construction principaux :</label>
            <input type="text" id="constructionMaterials" name="constructionMaterials" placeholder="Exemple : béton, bois, acier" required><br><br>

            <label for="evacuationPlan">Plan d'évacuation disponible :</label>
            <select id="evacuationPlan" name="evacuationPlan" required>
                <option value="oui">Oui</option>
                <option value="non">Non</option>
            </select><br><br>

            <h2>Sensibilisation et formation</h2>
            <label for="trainingSessions">Nombre de sessions de formation en sécurité incendie organisées cette année :</label>
            <input type="number" id="trainingSessions" name="trainingSessions" min="0" required><br><br>

            <label for="staffAwareness">Niveau de sensibilisation du personnel (1 à 5) :</label>
            <input type="number" id="staffAwareness" name="staffAwareness" min="1" max="5" required><br><br>

            <button type="button" onclick="submitAudit()">Soumettre l'Audit</button>
        </form>

        <!-- Compte rendu -->
        <div id="auditResult" style="flex: 1; display: none;">
            <h2>Compte Rendu de votre Audit</h2>
            <p id="auditMessage"></p>
        </div>
    </div>

    <!-- Bouton Retour -->
    <div style="margin-top: 20px;">
        <button onclick="window.location.href='/'">Retour à la page d'accueil</button>
    </div>

    <script>
        async function submitAudit() {
            const formData = new FormData(document.getElementById("auditForm"));

            try {
                const response = await fetch("/api/submit-audit", {
                    method: "POST",
                    body: formData,
                });

                const result = await response.json();

                // Générer les recommandations
                let recommendations = "<h3>Recommandations :</h3><ul>";
                result.recommendations.forEach(rec => {
                    recommendations += `<li>${rec}</li>`;
                });
                recommendations += "</ul>";

                // Afficher le compte rendu
                const auditMessage = `
                    <strong>Status :</strong> ${result.status}<br>
                    <strong>Message :</strong> ${result.message}<br><br>
                    <strong>Résumé des informations saisies :</strong><br>
                    <strong>Nom du bâtiment :</strong> ${result.data.buildingName}<br>
                    <strong>Nombre d'extincteurs :</strong> ${result.data.fireExtinguishers}<br>
                    <strong>Nombre de sorties de secours :</strong> ${result.data.emergencyExits}<br>
                    <strong>Nombre de détecteurs de fumée :</strong> ${result.data.smokeDetectors}<br>
                    <strong>Taille du bâtiment :</strong> ${result.data.buildingSize} m²<br>
                    <strong>Nombre de pièces :</strong> ${result.data.roomCount}<br>
                    <strong>Tailles des pièces :</strong> ${result.data.roomSizes.join(", ")} m²<br>
                    ${recommendations}
                `;
                document.getElementById("auditMessage").innerHTML = auditMessage;
                document.getElementById("auditResult").style.display = "block";
            } catch (error) {
                console.error("Erreur lors de l'envoi de l'audit :", error);
                alert("Une erreur est survenue lors de l'envoi de l'audit.");
            }
        }

        function toggleAuditSections() {
            const usage = document.getElementById('buildingUsage').value;
            document.getElementById('habitationSection').style.display = usage === 'personnel' ? 'block' : 'none';
            document.getElementById('entrepriseSection').style.display = usage === 'professionnel' ? 'block' : 'none';
        }
        window.onload = toggleAuditSections;
    </script>
</body>
</html>