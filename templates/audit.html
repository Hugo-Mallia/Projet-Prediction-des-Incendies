<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audit de Prévention des Incendies</title>
    <link rel="stylesheet" href="/static/style.css">
    <style>
        #auditResult {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ccc;
            background-color: #f9f9f9;
        }
    </style>
</head>
<body>
    <h1>Audit de Prévention des Incendies</h1>
    <div style="display: flex; gap: 20px;">
        <!-- Formulaire -->
        <form id="auditForm" style="flex: 1;">
            <h2>Informations générales</h2>
            <label for="buildingName">Nom du bâtiment :</label>
            <input type="text" id="buildingName" name="buildingName" required><br><br>

            <label for="buildingType">Type de bâtiment :</label>
            <select id="buildingType" name="buildingType" required>
                <option value="immeuble">Immeuble</option>
                <option value="maison">Maison</option>
                <option value="entrepot">Entrepôt</option>
                <option value="usine">Usine</option>
                <option value="etablissement_public">Établissement recevant du public</option>
            </select><br><br>

            <label for="buildingUsage">Usage du bâtiment :</label>
            <select id="buildingUsage" name="buildingUsage" required>
                <option value="professionnel">Professionnel</option>
                <option value="personnel">Personnel</option>
            </select><br><br>

            <label for="buildingSize">Taille du bâtiment (en m²) :</label>
            <input type="number" id="buildingSize" name="buildingSize" min="0" required><br><br>

            <h2>Équipements de sécurité</h2>
            <label for="fireExtinguishers">Nombre d'extincteurs :</label>
            <input type="number" id="fireExtinguishers" name="fireExtinguishers" min="0" required><br><br>

            <label for="emergencyExits">Nombre de sorties de secours :</label>
            <input type="number" id="emergencyExits" name="emergencyExits" min="0" required><br><br>

            <label for="smokeDetectors">Nombre de détecteurs de fumée :</label>
            <input type="number" id="smokeDetectors" name="smokeDetectors" min="0" required><br><br>

            <label for="fireDrills">Dernière date d'exercice d'évacuation :</label>
            <input type="date" id="fireDrills" name="fireDrills" required><br><br>

            <h2>Structure et conformité</h2>
            <label for="roomCount">Nombre de pièces dans le bâtiment :</label>
            <input type="number" id="roomCount" name="roomCount" min="1" required><br><br>

            <label for="roomSizes">Taille de chaque pièce (en m², séparées par des virgules) :</label>
            <input type="text" id="roomSizes" name="roomSizes" placeholder="Exemple : 20, 15, 30" required><br><br>

            <label for="constructionMaterials">Matériaux de construction principaux :</label>
            <input type="text" id="constructionMaterials" name="constructionMaterials" placeholder="Exemple : béton, bois, acier" required><br><br>

            <label for="evacuationPlan">Plan d'évacuation disponible :</label>
            <select id="evacuationPlan" name="evacuationPlan" required>
                <option value="oui">Oui</option>
                <option value="non">Non</option>
            </select><br><br>

            <h2>Sensibilisation et formation</h2>
            <label for="trainingSessions">Nombre de sessions de formation en sécurité incendie organisées cette année :</label>
            <input type="number" id="trainingSessions" name="trainingSessions" min="0" required><br><br>

            <label for="staffAwareness">Niveau de sensibilisation du personnel (1 à 5) :</label>
            <input type="number" id="staffAwareness" name="staffAwareness" min="1" max="5" required><br><br>

            <button type="button" onclick="submitAudit()">Soumettre l'Audit</button>
        </form>

        <!-- Compte rendu -->
        <div id="auditResult" style="flex: 1; display: none;">
            <h2>Compte Rendu de votre Audit</h2>
            <p id="auditMessage"></p>
        </div>
    </div>

    <!-- Bouton Retour -->
    <div style="margin-top: 20px;">
        <button onclick="window.location.href='/'">Retour à la page d'accueil</button>
    </div>

    <script>
        async function submitAudit() {
            const formData = new FormData(document.getElementById("auditForm"));

            try {
                const response = await fetch("/api/submit-audit", {
                    method: "POST",
                    body: formData,
                });

                const result = await response.json();

                // Générer les recommandations
                let recommendations = "<h3>Recommandations :</h3><ul>";
                result.recommendations.forEach(rec => {
                    recommendations += `<li>${rec}</li>`;
                });
                recommendations += "</ul>";

                // Afficher le compte rendu
                const auditMessage = `
                    <strong>Status :</strong> ${result.status}<br>
                    <strong>Message :</strong> ${result.message}<br><br>
                    <strong>Résumé des informations saisies :</strong><br>
                    <strong>Nom du bâtiment :</strong> ${result.data.buildingName}<br>
                    <strong>Nombre d'extincteurs :</strong> ${result.data.fireExtinguishers}<br>
                    <strong>Nombre de sorties de secours :</strong> ${result.data.emergencyExits}<br>
                    <strong>Nombre de détecteurs de fumée :</strong> ${result.data.smokeDetectors}<br>
                    <strong>Taille du bâtiment :</strong> ${result.data.buildingSize} m²<br>
                    <strong>Nombre de pièces :</strong> ${result.data.roomCount}<br>
                    <strong>Tailles des pièces :</strong> ${result.data.roomSizes.join(", ")} m²<br>
                    ${recommendations}
                `;
                document.getElementById("auditMessage").innerHTML = auditMessage;
                document.getElementById("auditResult").style.display = "block";
            } catch (error) {
                console.error("Erreur lors de l'envoi de l'audit :", error);
                alert("Une erreur est survenue lors de l'envoi de l'audit.");
            }
        }
    </script>
</body>
</html>